<!DOCTYPE html>
<html>
<head>
  <title>Infliker Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4">
  <!-- Login Form -->
  <div id="auth">
    <input type="email" id="email" placeholder="Email" class="border p-2">
    <input type="password" id="password" placeholder="Password" class="border p-2">
    <button id="login" class="bg-blue-500 text-white p-2">Login</button>
  </div>

  <!-- Post Editor -->
  <div id="app" style="display:none;">
    <input type="text" id="title" placeholder="Title" class="border p-2">
    <input type="text" id="slug" placeholder="Slug" class="border p-2">
    <textarea id="content" placeholder="Content" class="border p-2"></textarea>
    <textarea id="excerpt" placeholder="Excerpt" class="border p-2"></textarea>
    <button id="publish" class="bg-green-500 text-white p-2">Publish</button>
    <div id="status"></div>
  </div>

  <script>
    const apiBase = 'https://api.infliker.fun/api';

    // Login
    document.getElementById('login').onclick = async ()=>{
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      const res = await fetch(apiBase+'/auth/login', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({email,password})
      });
      const data = await res.json();
      if(data.ok){
        localStorage.setItem('token', data.token);
        document.getElementById('auth').style.display='none';
        document.getElementById('app').style.display='block';
      } else alert('Login failed: '+data.error);
    }

    // Publish post
    document.getElementById('publish').onclick = async ()=>{
      const body = {
        title: document.getElementById('title').value,
        slug: document.getElementById('slug').value,
        content: document.getElementById('content').value,
        excerpt: document.getElementById('excerpt').value,
        published: true
      };
      const token = localStorage.getItem('token');
      const res = await fetch(apiBase+'/posts',{
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'Authorization': `Bearer ${token}`
        },
        body: JSON.stringify(body)
      });
      const data = await res.json();
      if(data.ok) document.getElementById('status').innerText='Published';
      else document.getElementById('status').innerText='Error: '+data.error;
    }
  </script>
</body>
</html>
